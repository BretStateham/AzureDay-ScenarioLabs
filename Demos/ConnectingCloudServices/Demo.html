<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Markdown Preview</title>
<style>
body{font-family:helvetica, arial, freesans, clean, sans-serif;color:#333;line-height:1.6;font-size:14px}.markdown-body{line-height:1.6;font-size:14px}.markdown-body > *:first-child{margin-top:0 !important}.markdown-body > *:last-child{margin-bottom:0 !important}.markdown-body a.absent{color:#c00}.markdown-body h1{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:28px;margin:20px 0 10px;padding:0}.markdown-body h2{font-weight:700;-webkit-font-smoothing:antialiased;color:#000;font-size:24px;border-bottom-color:#ccc;border-bottom-width:1px;border-bottom-style:solid;margin:20px 0 10px;padding:0}.markdown-body h3{font-weight:700;-webkit-font-smoothing:antialiased;font-size:18px;margin:20px 0 10px;padding:0}.markdown-body h4{font-weight:700;-webkit-font-smoothing:antialiased;font-size:16px;margin:20px 0 10px;padding:0}.markdown-body h5{font-weight:700;-webkit-font-smoothing:antialiased;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body h6{font-weight:700;-webkit-font-smoothing:antialiased;color:#777;font-size:14px;margin:20px 0 10px;padding:0}.markdown-body blockquote{color:#777;border-left-color:#ddd;border-left-width:4px;border-left-style:solid;margin:15px 0;padding:0 15px}.markdown-body dl{margin:15px 0;padding:0}.markdown-body table{border-collapse:collapse;margin:15px 0;padding:0}.markdown-body pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;margin:15px 0;padding:6px 10px}.markdown-body li p.first{display:inline-block}.markdown-body dl dt{font-size:14px;font-style:italic;font-weight:700;margin:15px 0 5px;padding:0}.markdown-body dl dt:first-child{padding:0}.markdown-body dl dd{margin:0 0 15px;padding:0 15px}.markdown-body table tr{border-top-color:#ccc;border-top-width:1px;border-top-style:solid;background-color:#fff;margin:0;padding:0}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.markdown-body img{max-width:100%}.markdown-body span.frame{overflow:hidden;display:block}.markdown-body span.frame > span{border:1px solid #ddd;width:auto;overflow:hidden;float:left;display:block;margin:13px 0 0;padding:7px}.markdown-body span.frame span img{float:left;display:block}.markdown-body span.frame span span{color:#333;clear:both;display:block;padding:5px 0 0}.markdown-body span.align-center > span{text-align:center;overflow:hidden;display:block;margin:13px auto 0}.markdown-body span.align-center span img{text-align:center;margin:0 auto}.markdown-body span.align-right > span{text-align:right;overflow:hidden;display:block;margin:13px 0 0}.markdown-body span.align-right span img{text-align:right;margin:0}.markdown-body span.float-left{overflow:hidden;margin-right:13px;float:left;display:block}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{overflow:hidden;margin-left:13px;float:right;display:block}.markdown-body span.float-right > span{text-align:right;overflow:hidden;display:block;margin:13px auto 0}.markdown-body pre > code{border:currentColor;white-space:pre;margin:0;padding:0}.markdown-body .highlight pre{border-radius:3px;border:1px solid #ccc;line-height:19px;overflow:auto;font-size:13px;background-color:#f8f8f8;padding:6px 10px}.markdown-body p,.markdown-body li{margin:15px 0}.markdown-body ul,.markdown-body ol{padding-left:30px;margin:15px 0}.markdown-body > h2:first-child,.markdown-body > h1:first-child,.markdown-body > h1:first-child + h2{border:0 currentColor;padding-top:0;margin-top:0}.markdown-body > h3:first-child,.markdown-body > h4:first-child,.markdown-body > h5:first-child,.markdown-body > h6:first-child{padding-top:0;margin-top:0}.markdown-body h1 + p,.markdown-body h2 + p,.markdown-body h3 + p,.markdown-body h4 + p,.markdown-body h5 + p,.markdown-body h6 + p,.markdown-body ul li > :first-child,.markdown-body ol li > :first-child,.markdown-body dl dt > :first-child,.markdown-body dl dd > :first-child,.markdown-body blockquote > :first-child,.markdown-body table tr th > :first-child,.markdown-body table tr td > :first-child{margin-top:0}.markdown-body ul li > :last-child,.markdown-body ol li > :last-child,.markdown-body dl dt > :last-child,.markdown-body dl dd > :last-child,.markdown-body blockquote > :last-child,.markdown-body table tr th > :last-child,.markdown-body table tr td > :last-child{margin-bottom:0}.markdown-body table tr th,.markdown-body table tr td{border:1px solid #ccc;text-align:left;margin:0;padding:6px 13px}.markdown-body span.align-center,.markdown-body span.align-right{overflow:hidden;clear:both;display:block}.markdown-body code,.markdown-body tt{border-radius:3px;border:1px solid #eaeaea;white-space:nowrap;background-color:#f8f8f8;margin:0 2px;padding:0 5px}.markdown-body pre code,.markdown-body pre tt{border:currentColor;background-color:transparent}span.codelanguage{display:none}
</style>
</head>
<body>
<div class="markdown-body">
<p><a name="title"></a></p>

<h1 id="Connecting_Cloud_Services">Connecting Cloud Services</h1>

<hr>

<p><a name="Overview"></a></p>

<h2 id="Overview">Overview</h2>

<p>This demonstration will show how to connect a traditional Windows Azure web role to a virtual machine running SQL server using a virtual network. </p>
<blockquote>
<p><strong>Note:</strong> In order to run through this complete demo, you must have network connectivity and a Microsoft account.</p>
</blockquote>
<p><a id="goals"></a></p>

<h3 id="Goals">Goals</h3>

<p>In this demo, you will see these things:</p>

<ol>
<li> Configuring a simple virtual network. </li>
<li> Configure a SQL server virtual machine.</li>
<li> Connecting a web role to the Windows Azure Virtual Network.</li>
<li> Taking advantage of full SQL server from a web role.</li>
<li> This configuration is low latency and highly secure as the web role and the virtual machine are on the same virtual network.</li>
</ol>

<p><a name="technologies"></a></p>

<h3 id="Key_Technologies">Key Technologies</h3>

<p>This demo uses the following technologies:</p>

<ul>
<li><a href="https://manage.windowsazure.com/">Windows Azure Management Portal</a></li>
<li><a href="http://www.microsoft.com/visualstudio/11">Visual Studio 2012</a></li>
</ul>

<p><a name="setup"></a></p>

<h3 id="Setup_and_Configuration">Setup and Configuration</h3>

<p>To configure this demonstration you will need to walk through the hands-on lab:</p>

<p><a href="https://github.com/WindowsAzure-TrainingKit/HOL-ConnectingApplicationsVNet">Connecting a PaaS application to an IaaS Application with a Virtual Network</a> </p>

<hr>

<p><a name="Demo"></a></p>

<h2 id="Demo">Demo</h2>

<p>This demo is composed of the following segments:</p>

<ol>
<li><a href="#segment1">Configure a virtual network</a></li>
<li><a href="#segment2">Deploy a SQL server into the Virtual Network</a></li>
<li><a href="#segment3">Configure Windows Azure Cloud Service Project</a></li>
</ol>

<p><a name="segment1"></a></p>

<h3 id="Segment_1_Configure_a_Virtual_Network">Segment 1: Configure a Virtual Network</h3>
<blockquote>
<p><strong>Speaking Point:</strong> In the next 7 minutes, I will configure a simple Windows Azure virtual network and deploy Windows Azure application to connect directly to a SQL Server running on a virtual machine. The application we are going to deploy has a dependency on SQL Server Full Text Search. To solve this problem we will create a virtual network, deploy a SQL Server and configure the Windows Azure Web Role to connect directly through the virtual network.</p>
</blockquote>
<ol>
<li><p>Follow the steps to configure the virtual network in the Windows Azure Management portal.</p>
<blockquote>
<p><strong>Note:</strong>  Refer to section <strong>Getting Started - Configuring Virtual Networking</strong> of the <strong>Connecting a PaaS application to an IaaS Application with a Virtual Network</strong> hands-on lab.</p>

<p><strong>Important:</strong> Name the virtual network <strong>MyVNET-1</strong> because MyVNET will already exist.</p>
</blockquote>
<p><img src="Images/creating-a-virtual-network.png?raw=true" alt="Creating a Virtual Network" title="Creating a Virtual Network">
</p>

<p><em>Creating a Virtual Network</em></p>
<blockquote>
<p><strong>Speaking Point:</strong> Creating a virtual network allows multiple cloud services to connect and communicate with each other. The advantages are the connection is secure because public endpoints like SQL Server 1433 are never exposed and very low latency because the applications are on the same network and do not require additional hops through the load balancer. </p>
</blockquote></li>
</ol>

<p><a name="segment2"></a></p>

<h3 id="Segment_2_Deploy_a_SQL_server_into_the_Virtual_Network">Segment 2: Deploy a SQL server into the Virtual Network</h3>

<ol>
<li><p>Provision a new virtual machine using the SQL Server evaluation edition into the virtual network to demonstrate how virtual machines get into the virtual network. </p></li>
<li><p>Select the <strong>AppSubnet</strong> Subnet.</p>
<blockquote>
<p><strong>Note:</strong> Use the initial steps from <strong>Exercise 1</strong> of the <strong>Connecting a PaaS application to an IaaS Application with a Virtual Network</strong> hands-on lab to walk through the virtual machine creation gallery experience. </p>

<p>Do not configure data disks and deploy the virtual machine- just walk through the wizard to show connectivity to the virtual network. Note that you have already done this in another SQL virtual machines. </p>
</blockquote>
<p><img src="Images/provisioning-a-new-vm.png?raw=true" alt="Provisioning a new virtual machine" title="Provisioning a new virtual machine">
</p>

<p><em>Provisioning a new virtual machine</em></p>
<blockquote>
<p><strong>Speaking Point:</strong> Explain that in order to connect you will select the virtual network to join the virtual machine to the virtual network you just created.</p>
</blockquote></li>
</ol>

<p><a name="segment3"></a></p>

<h3 id="Segment_3_Configure_Windows_Azure_Cloud_Service_Project">Segment 3: Configure Windows Azure Cloud Service Project</h3>
<blockquote>
<p><strong>Speaking Point:</strong> I have previously configured this SQL Server with the database for the application, enabled full text search and have configured the data disks and firewall rules. </p>
</blockquote>
<ol>
<li><p>Log into the already configured SQL Server.</p>
<blockquote>
<p><strong>Speaking Point:</strong> To have the application connected to the SQL Server I need the IP address. Virtual network solutions do not have out-of-the-box name resolution. </p>
</blockquote></li>
<li><p>Run <strong>IPConfig</strong> to retrieve the SQL Server IP address.</p>

<p><img src="Images/ipconfig.png?raw=true" alt="IPConfig" title="IPConfig">
</p>

<p><em>Getting the IP of the SQL Server virtual machine</em></p></li>
<li><p>Open the <strong>Windows Azure Project</strong> from the <strong>Connecting a PaaS application to an IaaS Application with a Virtual Network</strong> hands-on lab. </p></li>
<li><p>In Visual Studio, open the <strong>Web.config</strong> and modify the connection strings to use the new IP Address for the SQL Server. </p>
<blockquote>
<p><strong>Note:</strong> Refer to Exercise 2 - Step 9 of the <em>Connecting a PaaS application to an IaaS Application with a Virtual Network</em> hands-on lab.</p>
</blockquote></li>
<li><p>Open the <strong>ServiceConfiguration.cscfg</strong> file and add the network configuration to connect to the virtual network.</p>
<blockquote>
<p><strong>Note:</strong> Refer to Exercise 2 - Step 10 of the of the <em>Connecting a PaaS application to an IaaS Application with a Virtual Network</em> hands-on lab.</p>
</blockquote></li>
<li><p>Walk through the steps to deploy the application to the same cloud service but do not actually finish the deployment (not enough time to actually deploy).</p></li>
<li><p>Browse to running site - demonstrate search.</p>

<p><img src="Images/browsing-the-web-site.png?raw=true" alt="Browsing the Application" title="Browsing the Application">
</p>

<p><em>Browsing the Application</em></p></li>
</ol>

<hr>

<p><a name="summary"></a></p>

<h2 id="Summary">Summary</h2>

<p>In this demonstration you saw how to provision a simple cloud only virtual network that allows you to directly connect a cloud service with a traditional Windows Azure PaaS webrole directly to a cloud service hosting full SQL Server. </p>

</div>
</body>
</html>
